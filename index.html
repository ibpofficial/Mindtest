<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MindScrape Pro - Digital Behavior Analytics</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Chart.js for Graphs (Fixed Version) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;500;600;800&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            color: #0f172a;
            overflow-x: hidden;
        }
        
        /* Animated Background Grid */
        .bg-grid-animated {
            background-size: 40px 40px;
            background-image: 
                linear-gradient(to right, rgba(226, 232, 240, 0.5) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(226, 232, 240, 0.5) 1px, transparent 1px);
            animation: moveGrid 20s linear infinite;
        }

        @keyframes moveGrid {
            0% { background-position: 0 0; }
            100% { background-position: 40px 40px; }
        }

        .fade-in {
            animation: fadeIn 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
            opacity: 0;
            transform: translateY(10px);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .hidden-section { display: none !important; }

        /* Terminal Styling */
        .terminal-scroll::-webkit-scrollbar { width: 6px; }
        .terminal-scroll::-webkit-scrollbar-track { background: #1e293b; }
        .terminal-scroll::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
        
        /* Live Score Pulse */
        @keyframes scorePulse {
            0% { transform: scale(1); color: #2563eb; }
            50% { transform: scale(1.1); color: #4f46e5; }
            100% { transform: scale(1); color: #2563eb; }
        }
        .score-update { animation: scorePulse 0.3s ease-in-out; }

        /* Shimmer Loading Effect */
        .shimmer {
            background: #f1f5f9;
            background-image: linear-gradient(to right, #f1f5f9 0%, #cbd5e1 20%, #f1f5f9 40%, #f1f5f9 100%);
            background-repeat: no-repeat;
            background-size: 800px 100%; 
            animation: placeholderShimmer 1.5s infinite linear forwards;
            color: transparent !important;
            border-radius: 6px;
        }
        
        @keyframes placeholderShimmer {
            0% { background-position: -468px 0; }
            100% { background-position: 468px 0; }
        }

        /* Glassmorphism Modal */
        .modal-overlay {
            background: rgba(15, 23, 42, 0.4);
            backdrop-filter: blur(8px);
        }
        
        /* Chat Bubble Styles */
        .chat-bubble {
            max-width: 85%;
            padding: 12px 16px;
            border-radius: 16px;
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 8px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        .user-bubble {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 2px;
        }
        .ai-bubble {
            background-color: white;
            color: #334155;
            border: 1px solid #e2e8f0;
            margin-right: auto;
            border-bottom-left-radius: 2px;
        }

        /* Custom Button Hover */
        .btn-hover-effect {
            transition: all 0.2s;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .btn-hover-effect:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        /* Animation for the Team Modal */
.fade-in {
    animation: fadeIn 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    opacity: 0;
    transform: translateY(10px);
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

    </style>
</head>
<body class="min-h-screen selection:bg-indigo-100 selection:text-indigo-900 relative bg-grid-animated">

    <!-- INFO MODAL -->
    <div id="info-modal" class="hidden fixed inset-0 z-[100] modal-overlay flex items-center justify-center p-4 fade-in">
        <div class="bg-white rounded-3xl shadow-2xl max-w-lg w-full p-8 relative border border-slate-100">
            <button onclick="toggleModal(false)" class="absolute top-4 right-4 p-2 hover:bg-slate-100 rounded-full transition-colors">
                <i data-lucide="x" class="w-5 h-5 text-slate-400"></i>
            </button>
            
            <div class="flex items-center gap-3 mb-6">
                <div class="p-3 bg-indigo-50 rounded-xl">
                    <i data-lucide="cpu" class="w-6 h-6 text-indigo-600"></i>
                </div>
                <h3 class="text-xl font-bold text-slate-900">System Architecture</h3>
            </div>

            <div class="space-y-4 text-sm text-slate-600 leading-relaxed">
                <p>
                    <strong class="text-slate-900">Why is an API Key used?</strong><br>
                    This application acts as a "frontend terminal." It doesn't "think" on its own. Instead, it securely sends your anonymized answers to <strong class="text-indigo-600">DeepSeek AI</strong> (a powerful large language model) via the OpenRouter API.
                </p>
                <div class="p-4 bg-slate-50 rounded-xl border border-slate-100">
                    <p class="font-mono text-xs text-slate-500 mb-2">DATA FLOW:</p>
                    <div class="flex items-center justify-between text-xs font-bold text-slate-700">
                        <span>You (Browser)</span>
                        <i data-lucide="arrow-right" class="w-4 h-4 text-slate-400"></i>
                        <span>API Gate</span>
                        <i data-lucide="arrow-right" class="w-4 h-4 text-slate-400"></i>
                        <span>DeepSeek Neural Net</span>
                    </div>
                </div>
                <p>
                    <strong class="text-slate-900">Why is it complex?</strong><br>
                    The "complexity" comes from the AI's ability to pattern-match your habits against millions of psychological data points to generate a unique archetype, rather than just a simple "Good/Bad" result.
                </p>
            </div>
            
            <button onclick="toggleModal(false)" class="w-full mt-6 py-3 bg-slate-900 hover:bg-slate-800 text-white font-bold rounded-xl transition-all">
                Understood
            </button>
        </div>
    </div>

    <!-- Floating Controls -->
    <div class="fixed top-6 right-6 z-50 flex flex-col items-end gap-2">
        <!-- HUD -->
        <div id="mini-hud" class="hidden opacity-0 transition-opacity duration-500 flex items-center gap-3 bg-slate-50 border border-slate-200 px-3 py-1.5 rounded-full shadow-lg backdrop-blur-sm bg-white/80">
            <span class="text-[10px] text-slate-400 font-bold uppercase tracking-wider">Resilience</span>
            <span id="live-score-display" class="font-mono font-bold text-indigo-600 leading-none text-sm">0%</span>
        </div>

        <!-- Control Buttons -->
        <div class="flex flex-col gap-2 items-end">
            <!-- Our Team Button -->
            <button onclick="toggleTeamModal(true)" class="group flex items-center gap-2 px-4 py-3 rounded-full bg-white/80 backdrop-blur-sm border border-slate-200 hover:border-indigo-200 hover:shadow-lg transition-all text-sm font-medium text-slate-700 shadow-md">
                <i data-lucide="users" class="w-5 h-5 text-indigo-500"></i>
                <span class="hidden md:inline opacity-0 group-hover:opacity-100 transition-opacity duration-200">Our Team</span>
            </button>

            <!-- Info Button -->
            <button onclick="toggleModal(true)" class="group flex items-center gap-2 px-4 py-3 rounded-full bg-white/80 backdrop-blur-sm border border-slate-200 hover:border-indigo-200 hover:shadow-lg transition-all text-sm font-medium text-slate-700 shadow-md">
                <i data-lucide="info" class="w-5 h-5 text-indigo-500"></i>
                <span class="hidden md:inline opacity-0 group-hover:opacity-100 transition-opacity duration-200">How it works</span>
            </button>
        </div>
    </div>

    <!-- Logo - Top Left -->
    <div class="fixed top-6 left-6 z-50 flex items-center gap-3 bg-white/80 backdrop-blur-sm border border-slate-200 rounded-full px-4 py-2.5 shadow-lg">
        <div class="p-2 bg-indigo-600 rounded-lg shadow-md shadow-indigo-200">
            <i data-lucide="activity" class="w-4 h-4 text-white"></i>
        </div>
        <div>
            <span class="font-bold tracking-tight text-sm text-slate-900 block">MIND SCRAPE</span>
            <span class="text-[10px] text-slate-500 font-mono tracking-widest">PRO  </span>
        </div>
    </div>

    <!-- Main Container -->
    <div class="relative z-10 max-w-5xl mx-auto min-h-screen flex flex-col justify-center p-4 md:p-6 pt-16">
        <!-- FULL PAGE TEAM MODAL -->
<!-- Add this snippet inside your <body> tag -->
<div id="team-modal" class="hidden fixed inset-0 z-[100] bg-white overflow-y-auto fade-in">
    <div class="max-w-6xl mx-auto p-6 md:p-12 relative min-h-screen">
        
        <!-- Header -->
        <div class="flex justify-between items-center mb-12 sticky top-0 bg-white/90 backdrop-blur-sm py-4 z-10 border-b border-slate-100">
            <div class="flex items-center gap-4">
                <div class="p-3 bg-blue-600 rounded-2xl shadow-lg shadow-blue-200">
                    <!-- Icon: Users -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                </div>
                <div>
                    <h2 class="text-3xl font-black text-slate-900 tracking-tight">The Visionaries</h2>
                    <p class="text-sm text-slate-500 font-medium">MindScrape Project • Fall 2025</p>
                </div>
            </div>
            <button onclick="toggleTeamModal(false)" class="group flex items-center gap-2 px-6 py-3 rounded-xl bg-slate-100 hover:bg-slate-200 transition-all font-bold text-slate-600">
                <span>Close</span>
                <!-- Icon: X -->
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="group-hover:rotate-90 transition-transform"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
            </button>
        </div>

        <!-- Team Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            
            <!-- Member 1 -->
            <div class="flex flex-col md:flex-row items-center md:items-start gap-6 p-8 rounded-[2rem] border border-slate-200 bg-white shadow-xl shadow-slate-200/50 hover:shadow-2xl hover:border-blue-200 transition-all duration-300 group">
                <div class="w-32 h-32 rounded-full p-1 bg-gradient-to-br from-blue-500 to-indigo-600 flex-shrink-0 shadow-lg group-hover:scale-105 transition-transform">
                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Alex&backgroundColor=c7d2fe" alt="Member" class="w-full h-full object-cover rounded-full border-4 border-white">
                </div>
                <div class="text-center md:text-left w-full">
                    <div class="inline-block px-3 py-1 rounded-full bg-blue-50 text-blue-700 text-xs font-bold uppercase tracking-wider mb-2">Lead Architect</div>
                    <div class="inline-block px-3 py-1 rounded-full bg-amber-50 text-amber-700 text-xs font-bold uppercase tracking-wider mb-2">Backend & Security</div>
                    <div class="inline-block px-3 py-1 rounded-full bg-rose-50 text-rose-700 text-xs font-bold uppercase tracking-wider mb-2">Api calls </div>
                    <div class="inline-block px-3 py-1 rounded-full bg-emerald-50 text-emerald-700 text-xs font-bold uppercase tracking-wider mb-2">Logics backend with UX</div>
                    
                    <h3 class="text-2xl font-black text-slate-900 mb-1">Ishant upadhyay </h3>
                    <p class="text-sm font-mono text-slate-400 mb-4 flex items-center justify-center md:justify-start gap-2">
                        <!-- Icon: ID Card -->
                        <svg xmlns="ishant.jfif" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="13" x="3" y="5" rx="2"/><circle cx="9" cy="9" r="2"/><path d="M7 15h4"/><path d="M15 15h2"/><path d="M15 11h2"/></svg>
                        ERP-:38116
                    </p>
                    <div class="p-4 bg-slate-50 rounded-xl border border-slate-100 text-sm text-slate-600 leading-relaxed">
                        <span class="font-bold text-slate-900 block mb-1">Contribution:</span>
.“I built the entire backend ecosystem, including all APIs, system logic, state management, scoring engines, and AI integrations. While the UI was separate, every functional process behind this platform was engineered by me.”
                    </div>
                </div>
            </div>

            <!-- Member 2 -->
            <div class="flex flex-col md:flex-row items-center md:items-start gap-6 p-8 rounded-[2rem] border border-slate-200 bg-white shadow-xl shadow-slate-200/50 hover:shadow-2xl hover:border-emerald-200 transition-all duration-300 group">
                <div class="w-32 h-32 rounded-full p-1 bg-gradient-to-br from-emerald-400 to-teal-500 flex-shrink-0 shadow-lg group-hover:scale-105 transition-transform">
                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Sarah&backgroundColor=a7f3d0" alt="Member" class="w-full h-full object-cover rounded-full border-4 border-white">
                </div>
                <div class="text-center md:text-left w-full">
                    <div class="inline-block px-3 py-1 rounded-full bg-emerald-50 text-emerald-700 text-xs font-bold uppercase tracking-wider mb-2">research</div>
                      <div class="inline-block px-3 py-1 rounded-full bg-emerald-50 text-emerald-700 text-xs font-bold uppercase tracking-wider mb-2">analysis</div>
                      <div class="inline-block px-3 py-1 rounded-full bg-emerald-50 text-emerald-700 text-xs font-bold uppercase tracking-wider mb-2">pattern analysis</div>
                    <h3 class="text-2xl font-black text-slate-900 mb-1">Kritika singh</h3>
                    <p class="text-sm font-mono text-slate-400 mb-4 flex items-center justify-center md:justify-start gap-2">
                        <svg xmlns="kritika.jpeg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="13" x="3" y="5" rx="2"/><circle cx="9" cy="9" r="2"/><path d="M7 15h4"/><path d="M15 15h2"/><path d="M15 11h2"/></svg>
                        ERP-:43248
                    </p>
                    <div class="p-4 bg-slate-50 rounded-xl border border-slate-100 text-sm text-slate-600 leading-relaxed">
                        <span class="font-bold text-slate-900 block mb-1">Contribution:</span>
                        Conducted in-depth research on digital behavior psychology, crafted the diagnostic questionnaire framework, validated scoring distributions, and analyzed survey patterns to refine category weights. Designed the logic for generating accurate, personalized psychometric reports.
                    </div>
                </div>
            </div>

            <!-- Member 3 -->
            <div class="flex flex-col md:flex-row items-center md:items-start gap-6 p-8 rounded-[2rem] border border-slate-200 bg-white shadow-xl shadow-slate-200/50 hover:shadow-2xl hover:border-amber-200 transition-all duration-300 group">
                <div class="w-32 h-32 rounded-full p-1 bg-gradient-to-br from-amber-400 to-orange-500 flex-shrink-0 shadow-lg group-hover:scale-105 transition-transform">
                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Rahul&backgroundColor=fde68a" alt="Member" class="w-full h-full object-cover rounded-full border-4 border-white">
                </div>
                <div class="text-center md:text-left w-full">
                    <div class="inline-block px-3 py-1 rounded-full bg-amber-50 text-amber-700 text-xs font-bold uppercase tracking-wider mb-2">UI & UX DESIGN </div>
                    <h3 class="text-2xl font-black text-slate-900 mb-1">Priyanshu Kumar</h3>
                    <p class="text-sm font-mono text-slate-400 mb-4 flex items-center justify-center md:justify-start gap-2">
                        <svg xmlns="priyanshu.jpeg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="13" x="3" y="5" rx="2"/><circle cx="9" cy="9" r="2"/><path d="M7 15h4"/><path d="M15 15h2"/><path d="M15 11h2"/></svg>
                        ERP-:00000
                    </p>
                    <div class="p-4 bg-slate-50 rounded-xl border border-slate-100 text-sm text-slate-600 leading-relaxed">
                        <span class="font-bold text-slate-900 block mb-1">Contribution:</span>
                        Designed the complete user interface and experience flow, crafting clean layouts, intuitive interactions, and responsive components. Developed the visual identity, animations, and design system that shaped the platform’s overall feel and usability
                    </div>
                </div>
            </div>

            <!-- Member 4 -->
            <div class="flex flex-col md:flex-row items-center md:items-start gap-6 p-8 rounded-[2rem] border border-slate-200 bg-white shadow-xl shadow-slate-200/50 hover:shadow-2xl hover:border-rose-200 transition-all duration-300 group">
                <div class="w-32 h-32 rounded-full p-1 bg-gradient-to-br from-rose-400 to-pink-500 flex-shrink-0 shadow-lg group-hover:scale-105 transition-transform">
                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Nita&backgroundColor=fecdd3" alt="Member" class="w-full h-full object-cover rounded-full border-4 border-white">
                </div>
                <div class="text-center md:text-left w-full">
                    <div class="inline-block px-3 py-1 rounded-full bg-rose-50 text-rose-700 text-xs font-bold uppercase tracking-wider mb-2">DATA VERIFICATION & RESEARCH ABOUT REAL DATA</div>
                    <h3 class="text-2xl font-black text-slate-900 mb-1">Priyanshu </h3>
                    <p class="text-sm font-mono text-slate-400 mb-4 flex items-center justify-center md:justify-start gap-2">
                        <svg xmlns="priyanshu2.jpeg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="13" x="3" y="5" rx="2"/><circle cx="9" cy="9" r="2"/><path d="M7 15h4"/><path d="M15 15h2"/><path d="M15 11h2"/></svg>
                        ERP-:00000
                    </p>
                    <div class="p-4 bg-slate-50 rounded-xl border border-slate-100 text-sm text-slate-600 leading-relaxed">
                        <span class="font-bold text-slate-900 block mb-1">Contribution:</span>
                        Researched psychological markers for screen addiction, curated the question bank weights, and selected the recovery video protocols.
                    </div>
                </div>
            </div>

        </div>
        
        <div class="mt-12 text-center">
            <button onclick="toggleTeamModal(false)" class="px-8 py-3 bg-slate-900 text-white font-bold rounded-xl hover:bg-slate-800 transition-all shadow-lg hover:shadow-xl hover:-translate-y-1">
                Return to App
            </button>
        </div>
    </div>
</div>
        <!-- SECTION: WELCOME -->
        <div id="step-welcome" class="text-center space-y-8 fade-in">
            <div class="relative inline-block mb-4">
                <div class="absolute inset-0 bg-indigo-500/20 blur-3xl rounded-full"></div>
                <div class="relative p-8 rounded-3xl bg-white border border-slate-100 shadow-[0_20px_50px_-12px_rgba(79,70,229,0.15)] group hover:-translate-y-1 transition-transform duration-500">
                    <i data-lucide="brain-circuit" class="w-20 h-20 text-indigo-600 group-hover:scale-110 transition-transform duration-300"></i>
                </div>
            </div>
            
            <div class="space-y-4 max-w-2xl mx-auto">
                <div class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-emerald-50 border border-emerald-100 text-emerald-700 text-xs font-bold uppercase tracking-widest mb-2 shadow-sm">
                    <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
                    Neural Link Active
                </div>
                <h1 class="text-5xl md:text-7xl font-black tracking-tight text-slate-900 leading-[1.1]">
                    Digital Dependency<br><span class="text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-violet-600">Analyzer</span>
                </h1>
                <p class="text-slate-500 text-lg md:text-xl leading-relaxed">
                    A clinical-grade diagnostic tool powered by <span class="font-bold text-slate-700">DeepSeek AI</span>. 
                    Visualize your digital habits via radar topography and get prescribed recovery protocols.
                </p>
            </div>
            
            <div class="flex flex-col md:flex-row items-center justify-center gap-4 mt-8">
                <button onclick="startQuiz()" class="btn-hover-effect w-full md:w-auto px-8 py-4 bg-slate-900 text-white font-bold rounded-2xl flex items-center justify-center gap-3 text-lg">
                    Start Diagnostics
                    <i data-lucide="arrow-right" class="w-5 h-5"></i>
                </button>
                <button onclick="toggleModal(true)" class="btn-hover-effect w-full md:w-auto px-8 py-4 bg-white border border-slate-200 text-slate-700 font-bold rounded-2xl flex items-center justify-center gap-3 text-lg hover:bg-slate-50">
                    <i data-lucide="file-code" class="w-5 h-5 text-slate-400"></i>
                    View Architecture
                </button>
            </div>
            
            <div class="pt-12 grid grid-cols-3 gap-4 max-w-lg mx-auto opacity-60">
                <div class="text-center">
                    <div class="font-bold text-2xl text-slate-900">10</div>
                    <div class="text-[10px] uppercase tracking-wider text-slate-500">Data Points</div>
                </div>
                <div class="text-center border-l border-slate-200">
                    <div class="font-bold text-2xl text-slate-900">AI</div>
                    <div class="text-[10px] uppercase tracking-wider text-slate-500">Driven Analysis</div>
                </div>
                <div class="text-center border-l border-slate-200">
                    <div class="font-bold text-2xl text-slate-900">100%</div>
                    <div class="text-[10px] uppercase tracking-wider text-slate-500">Privacy First</div>
                </div>
            </div>
        </div>

        <!-- SECTION: QUIZ -->
        <div id="step-quiz" class="hidden-section w-full fade-in flex flex-col gap-6 max-w-3xl mx-auto">
            <div class="bg-white border border-slate-200 rounded-[2rem] p-6 md:p-10 shadow-xl relative overflow-hidden">
                <div class="relative z-10">
                    <div class="flex justify-between items-start mb-8">
                        <div class="inline-flex items-center justify-center p-4 rounded-2xl bg-indigo-50 text-indigo-600" id="question-icon-container"></div>
                        <div class="text-right">
                             <span class="text-xs font-bold text-slate-400 uppercase tracking-widest block mb-1">Scanning</span>
                             <div class="text-3xl font-black text-slate-900 tracking-tighter" id="progress-number">01<span class="text-slate-300 text-lg">/10</span></div>
                        </div>
                    </div>
                    <h2 id="question-text" class="text-2xl md:text-4xl font-bold text-slate-900 mb-3 leading-tight min-h-[4rem]">Loading...</h2>
                    <p class="text-slate-500 font-medium mb-10 flex items-center gap-2 bg-slate-50 inline-block px-3 py-1 rounded-lg text-sm">
                        <i data-lucide="info" class="w-4 h-4 text-indigo-500"></i>
                        <span id="question-reason">Assessing baseline usage habits.</span>
                    </p>
                    <div id="options-container" class="grid gap-3"></div>
                </div>
            </div>
            
            <!-- Terminal Log -->
            <div class="bg-slate-900 rounded-2xl p-5 font-mono text-xs md:text-sm h-32 overflow-hidden flex flex-col shadow-inner border border-slate-800">
                <div class="flex items-center justify-between border-b border-slate-800 pb-3 mb-2 text-slate-500">
                    <span class="flex items-center gap-2"><i data-lucide="terminal" class="w-4 h-4"></i> system_log.txt</span>
                    <div class="flex items-center gap-2">
                         <span class="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"></span>
                         <span class="text-[10px] font-bold text-emerald-500 uppercase tracking-wider">Monitoring</span>
                    </div>
                </div>
                <div id="terminal-output" class="terminal-scroll overflow-y-auto flex-1 space-y-2 text-slate-400 font-mono">
                    <div class="text-indigo-400">> Initializing heuristic sensors...</div>
                </div>
            </div>
        </div>

        <!-- SECTION: RESULT -->
        <div id="step-result" class="hidden-section fade-in pb-20">
            
            <!-- Header -->
            <div class="text-center mb-12">
                <div class="inline-block p-3 rounded-full bg-green-100 text-green-700 mb-4">
                    <i data-lucide="check-circle-2" class="w-8 h-8"></i>
                </div>
                <h2 class="text-4xl md:text-5xl font-black text-slate-900 mb-3">Analysis Complete</h2>
                <p class="text-slate-500 text-lg">Here is your detailed psychometric profile.</p>
            </div>

            <div class="grid md:grid-cols-12 gap-8">
                
                <!-- LEFT COLUMN: Scores & Graph -->
                <div class="md:col-span-5 space-y-6">
                    
                    <!-- Main Score Card -->
                    <div class="bg-white border border-slate-200 rounded-[2rem] p-8 text-center shadow-xl relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-indigo-500 to-purple-500"></div>
                        <span class="block text-slate-400 text-xs font-bold uppercase tracking-widest mb-6">Mental Resilience Score</span>
                        <div class="flex items-baseline justify-center gap-2 mb-6">
                            <span id="result-score" class="text-8xl font-black text-slate-900 tracking-tighter">0</span>
                            <span class="text-slate-300 text-2xl font-bold">/100</span>
                        </div>
                        <div class="flex justify-center">
                            <span id="score-badge" class="px-6 py-2 rounded-full bg-slate-100 border border-slate-200 text-sm font-bold text-slate-900 shadow-sm">
                                CALCULATING...
                            </span>
                        </div>
                    </div>

                    <!-- RADAR CHART -->
                    <div class="bg-white border border-slate-200 rounded-[2rem] p-6 shadow-lg flex flex-col items-center justify-center">
                        <div class="w-full flex justify-between items-center mb-4 px-2">
                             <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider">Habit Topography</h3>
                             <i data-lucide="radar" class="w-4 h-4 text-slate-300"></i>
                        </div>
                        <div class="w-full h-64 relative">
                            <canvas id="resultChart"></canvas>
                        </div>
                    </div>

                    <!-- Download Report Button -->
                    <button onclick="downloadReport()" class="w-full py-4 bg-indigo-50 hover:bg-indigo-100 text-indigo-700 font-bold rounded-2xl transition-colors flex items-center justify-center gap-2 border border-indigo-100">
                        <i data-lucide="download" class="w-5 h-5"></i>
                        Download Full Report (.txt)
                    </button>

                </div>

                <!-- RIGHT COLUMN: AI Analysis & Tips -->
                <div class="md:col-span-7 space-y-6">
                    
                    <!-- AI Narrative -->
                    <div class="bg-gradient-to-br from-white to-slate-50 border border-slate-200 rounded-[2rem] p-8 relative shadow-lg min-h-[280px]">
                        <div class="absolute top-0 right-0 p-6 opacity-[0.03]">
                            <i data-lucide="bot" class="w-48 h-48 text-slate-900"></i>
                        </div>
                        <div class="relative z-10">
                            <div class="flex items-center gap-2 mb-4">
                                <div class="w-2 h-2 rounded-full bg-blue-500 animate-pulse"></div>
                                <h3 class="text-xs font-bold text-blue-600 uppercase tracking-widest">DeepSeek Analysis</h3>
                            </div>
                            
                            <h2 id="result-title" class="text-3xl font-bold text-slate-900 mb-6 shimmer rounded w-3/4">Generating...</h2>
                            <p id="result-analysis" class="text-slate-600 text-lg leading-relaxed shimmer rounded h-32 w-full">
                                Establishing secure connection to neural network... Pattern matching answers against behavioral datasets...
                            </p>
                        </div>
                    </div>

                    <!-- Recommended Video -->
                    <div class="bg-slate-900 text-white border border-slate-900 rounded-[2rem] p-6 shadow-xl flex flex-col md:flex-row gap-6 items-center overflow-hidden relative">
                        <!-- Decor -->
                        <div class="absolute -right-10 -top-10 w-32 h-32 bg-indigo-500/20 rounded-full blur-2xl"></div>
                        
                        <div class="flex-1 relative z-10">
                            <h3 class="font-bold flex items-center gap-2 mb-3 text-indigo-300 text-xs uppercase tracking-widest">
                                <i data-lucide="play-circle" class="w-4 h-4"></i>
                                Prescribed Protocol
                            </h3>
                            <h4 id="video-title" class="text-xl font-bold text-white mb-2">Loading Recommendation...</h4>
                            <p id="video-desc" class="text-slate-400 text-sm leading-relaxed">Based on your score, this resource is highly relevant.</p>
                        </div>
                        <a id="video-link" href="#" target="_blank" class="flex-shrink-0 group relative overflow-hidden rounded-xl border border-slate-700 hover:border-indigo-500 transition-all w-full md:w-48 aspect-video bg-black flex items-center justify-center shadow-lg">
                            <img id="video-thumb" src="" class="absolute inset-0 w-full h-full object-cover opacity-60 group-hover:opacity-80 transition-opacity" alt="Video Thumbnail">
                            <div class="relative z-10 w-12 h-12 bg-white/10 backdrop-blur-sm rounded-full flex items-center justify-center group-hover:scale-110 transition-transform">
                                <i data-lucide="play" class="w-5 h-5 text-white fill-current"></i>
                            </div>
                        </a>
                    </div>
                    
                    <!-- Tips List -->
                    <div id="result-tips" class="space-y-3">
                         <!-- Loaded dynamically -->
                    </div>
                </div>
            </div>

            <!-- CHAT SECTION -->
            <div class="mt-12 bg-white border border-slate-200 rounded-[2rem] p-6 md:p-8 shadow-xl max-w-4xl mx-auto">
                <div class="flex items-center gap-4 mb-6 border-b border-slate-100 pb-6">
                    <div class="w-12 h-12 bg-blue-50 rounded-2xl flex items-center justify-center text-blue-600">
                        <i data-lucide="message-square-dashed" class="w-6 h-6"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-lg text-slate-900">Dr. AI Consultation</h3>
                        <p class="text-sm text-slate-500">Ask specific questions about your score or habits.</p>
                    </div>
                </div>

                <div id="chat-history" class="h-64 overflow-y-auto mb-4 bg-slate-50/50 rounded-2xl p-6 border border-slate-100 flex flex-col gap-3">
                    <div class="chat-bubble ai-bubble">
                        Hello. I've analyzed your data points. I'm ready to answer any questions about your digital habits.
                    </div>
                </div>

                <div class="flex gap-3 relative">
                    <input type="text" id="chat-input" placeholder="Type your question here..." class="flex-1 pl-6 pr-4 py-4 rounded-2xl bg-white border border-slate-200 focus:outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/10 transition-all text-sm font-medium text-slate-700 shadow-sm" onkeypress="if(event.key === 'Enter') sendChatMessage()">
                    <button onclick="sendChatMessage()" class="bg-slate-900 hover:bg-indigo-600 text-white px-8 rounded-2xl font-bold transition-colors flex items-center gap-2 shadow-lg shadow-slate-200">
                        Send <i data-lucide="send" class="w-4 h-4"></i>
                    </button>
                </div>
            </div>

            <div class="mt-16 text-center pb-10">
                <button onclick="restartApp()" class="group text-slate-400 hover:text-slate-800 text-sm font-bold transition-colors flex items-center gap-2 mx-auto uppercase tracking-widest">
                    <i data-lucide="refresh-cw" class="w-4 h-4 group-hover:rotate-180 transition-transform duration-500"></i>
                    Restart Assessment
                </button>
            </div>
        </div>

    </div>

    <script>
        // --- CONFIG ---
        const _p1 = "sk-or-v1-";
        const _p2 = "9ac6841858247e4920a8bd952b3b9be1257959ee";
        const _p3 = "542393db3655bc9074cfbc5d";
        const API_KEY = _p1 + _p2 + _p3;

        // --- DATA with CATEGORIES ---
        const QUESTIONS = [
            { id: 1, text: "Daily Screen Time (Non-Work)", category: "Exposure", icon: "clock", options: [ { text: "< 2 hours", score: 10, log: "Val: Low" }, { text: "2-4 hours", score: 8, log: "Val: Moderate" }, { text: "4-6 hours", score: 5, log: "Val: High" }, { text: "6-8 hours", score: 3, log: "Val: Excessive" }, { text: "8+ hours", score: 0, log: "Val: Critical" } ] },
            { id: 2, text: "First Action Upon Waking", category: "Dopamine", icon: "sun", options: [ { text: "Water / Stretch", score: 10, log: "Routine: Healthy" }, { text: "Brief check", score: 7, log: "Routine: Minor" }, { text: "Scroll 10-20 mins", score: 4, log: "Routine: Loop" }, { text: "Scroll 30+ mins", score: 0, log: "Routine: Dependency" } ] },
            { id: 3, text: "Unconscious Scrolling Frequency", category: "Control", icon: "scroll", options: [ { text: "Never", score: 10, log: "Freq: 0" }, { text: "Occasionally", score: 7, log: "Freq: Low" }, { text: "Daily", score: 4, log: "Freq: Med" }, { text: "Multiple times/day", score: 0, log: "Freq: High" } ] },
            { id: 4, text: "Phantom Vibration Syndrome", category: "Anxiety", icon: "smartphone", options: [ { text: "Never", score: 10, log: "Sens: Normal" }, { text: "Rarely", score: 8, log: "Sens: Minor" }, { text: "Sometimes", score: 5, log: "Sens: Elevated" }, { text: "Often", score: 0, log: "Sens: Critical" } ] },
            { id: 5, text: "Impact on Sleep Quality", category: "Sleep", icon: "moon", options: [ { text: "No impact", score: 10, log: "Sleep: OK" }, { text: "Hard to fall asleep", score: 6, log: "Sleep: Latency" }, { text: "Scroll late", score: 3, log: "Sleep: Displaced" }, { text: "Severe insomnia", score: 0, log: "Sleep: Disrupted" } ] },
            { id: 6, text: "Phone Separation Anxiety", category: "Anxiety", icon: "lock", options: [ { text: "Indifferent", score: 10, log: "Attach: None" }, { text: "Uncomfortable", score: 7, log: "Attach: Low" }, { text: "Anxious", score: 3, log: "Attach: Med" }, { text: "Panicked", score: 0, log: "Attach: High" } ] },
            { id: 7, text: "Content During Meals", category: "Dopamine", icon: "utensils", options: [ { text: "Never", score: 10, log: "Stim: None" }, { text: "Sometimes", score: 7, log: "Stim: Low" }, { text: "Usually", score: 3, log: "Stim: Med" }, { text: "Always", score: 0, log: "Stim: Constant" } ] },
            { id: 8, text: "Social Envy / Comparison", category: "Mental", icon: "frown", options: [ { text: "Not really", score: 10, log: "Impact: None" }, { text: "Occasionally", score: 7, log: "Impact: Low" }, { text: "Frequently", score: 3, log: "Impact: Med" }, { text: "Almost always", score: 0, log: "Impact: High" } ] },
            { id: 9, text: "Focus During Movies", category: "Focus", icon: "film", options: [ { text: "Easily", score: 10, log: "Attn: >90m" }, { text: "Usually", score: 8, log: "Attn: ~60m" }, { text: "Struggle", score: 3, log: "Attn: ~15m" }, { text: "Impossible", score: 0, log: "Attn: <5m" } ] },
            { id: 10, text: "Previous Limits Attempted", category: "Control", icon: "shield-alert", options: [ { text: "Yes, successful", score: 10, log: "Exec: High" }, { text: "No need", score: 8, log: "Exec: Normal" }, { text: "Failed", score: 4, log: "Exec: Low" }, { text: "Never tried", score: 5, log: "Exec: Unknown" } ] }
        ];

        // --- VIDEOS ---
        const VIDEOS = {
            CRITICAL: [
                { title: "Dopamine Detox", desc: "A necessary reset for your brain's reward system.", id: "p3JPa2mvSq4", thumb: "https://img.youtube.com/vi/p3JPa2mvSq4/mqdefault.jpg" },
                { title: "Phone Addiction is Ruining Your Life", desc: "Simon Sinek on the impact of technology on relationships.", id: "31F1eEzuPkw", thumb: "https://img.youtube.com/vi/31F1eEzuPkw/mqdefault.jpg" },
                { title: "How Social Media Hacks Your Brain", desc: "Understanding the engineering behind addiction.", id: "NUM_sB7i35k", thumb: "https://img.youtube.com/vi/NUM_sB7i35k/mqdefault.jpg" }
            ],
            MODERATE: [
                { title: "Atomic Habits", desc: "How to build small habits to regain control.", id: "PZ7lDrwYdZc", thumb: "https://img.youtube.com/vi/PZ7lDrwYdZc/mqdefault.jpg" },
                { title: "Break Phone Addiction", desc: "Practical steps to stop scrolling.", id: "WnU3w_fD3E8", thumb: "https://img.youtube.com/vi/WnU3w_fD3E8/mqdefault.jpg" },
                { title: "Quit Social Media", desc: "Cal Newport on the benefits of quitting.", id: "V74AxCqOTvg", thumb: "https://img.youtube.com/vi/V74AxCqOTvg/mqdefault.jpg" }
            ],
            OPTIMAL: [
                { title: "Digital Minimalism", desc: "Optimizing your digital life for deeper focus.", id: "w82a1FT5o88", thumb: "https://img.youtube.com/vi/w82a1FT5o88/mqdefault.jpg" },
                { title: "Deep Work", desc: "Rules for focused success in a distracted world.", id: "Hu4Yvq-g7_Y", thumb: "https://img.youtube.com/vi/Hu4Yvq-g7_Y/mqdefault.jpg" },
                { title: "The Art of Focus", desc: "Train your brain to focus.", id: "2iH9t6j5t9M", thumb: "https://img.youtube.com/vi/2iH9t6j5t9M/mqdefault.jpg" }
            ]
        };

        // --- STATE ---
        let currentQuestionIndex = 0;
        let answers = [];
        let currentScore = 0;
        let chartInstance = null;
        let finalAIAnalysis = ""; // Store for download

        // --- INIT ---
        lucide.createIcons();
        
        // Modal Logic
        function toggleModal(show) {
            const modal = document.getElementById('info-modal');
            if(show) {
                modal.classList.remove('hidden');
            } else {
                modal.classList.add('hidden');
            }
        }

        function showSection(id) {
            document.querySelectorAll('[id^="step-"]').forEach(el => {
                el.classList.add('hidden-section');
                el.classList.remove('fade-in'); 
            });
            const el = document.getElementById(id);
            el.classList.remove('hidden-section');
            void el.offsetWidth;
            el.classList.add('fade-in');
            lucide.createIcons();
            
            const hud = document.getElementById('mini-hud');
            if (id === 'step-quiz') {
                hud.classList.remove('hidden');
                setTimeout(() => hud.classList.remove('opacity-0'), 100);
            } else {
                hud.classList.add('opacity-0');
                setTimeout(() => hud.classList.add('hidden'), 500);
            }
        }

        function startQuiz() {
            currentQuestionIndex = 0;
            answers = [];
            currentScore = 0; 
            logTerminal("Session started. Heuristics active.");
            showSection('step-quiz');
            updateHUD(0);
            renderQuestion();
        }

        function restartApp() {
            document.getElementById('terminal-output').innerHTML = '<div class="text-indigo-400">> Resetting system...</div>';
            showSection('step-welcome');
        }

        function logTerminal(text, type="info") {
            const terminal = document.getElementById('terminal-output');
            const entry = document.createElement('div');
            if (type === "error") entry.className = "text-red-400";
            else if (type === "success") entry.className = "text-emerald-400";
            else entry.className = "text-slate-400";
            entry.innerText = `> ${text}`;
            terminal.appendChild(entry);
            terminal.scrollTop = terminal.scrollHeight;
        }

        function updateHUD(score) {
            const el = document.getElementById('live-score-display');
            el.innerText = score + "/100";
            el.classList.remove('score-update');
            void el.offsetWidth;
            el.classList.add('score-update');
        }

        function renderQuestion() {
            const q = QUESTIONS[currentQuestionIndex];
            document.getElementById('question-text').innerText = q.text;
            document.getElementById('question-reason').innerText = q.reason;
            document.getElementById('question-icon-container').innerHTML = `<i data-lucide="${q.icon}" class="w-8 h-8"></i>`;
            document.getElementById('progress-number').innerHTML = `${(currentQuestionIndex + 1).toString().padStart(2, '0')}<span class="text-slate-300 text-lg">/10</span>`;
            
            const container = document.getElementById('options-container');
            container.innerHTML = '';
            
            q.options.forEach((option, idx) => {
                const btn = document.createElement('button');
                btn.style.animationDelay = `${idx * 70}ms`;
                btn.className = "w-full text-left p-4 md:p-5 rounded-xl bg-slate-50 border-2 border-transparent hover:bg-white hover:border-indigo-500 hover:shadow-lg transition-all duration-200 flex items-center justify-between group animate-in slide-in-from-bottom-2 fade-in fill-mode-backwards";
                
                // Styling badges
                let badgeClass = "bg-slate-200 text-slate-500";
                if(option.score >= 8) badgeClass = "bg-emerald-100 text-emerald-700";
                else if(option.score <= 3) badgeClass = "bg-rose-100 text-rose-700";
                else badgeClass = "bg-amber-100 text-amber-700";

                btn.onclick = () => handleAnswer(option, q.category);
                btn.innerHTML = `
                    <div class="flex items-center gap-4">
                        <div class="w-8 h-8 rounded-lg bg-white border border-slate-200 text-slate-400 flex items-center justify-center text-xs font-bold font-mono group-hover:bg-indigo-600 group-hover:text-white group-hover:border-indigo-600 transition-colors">${String.fromCharCode(65 + idx)}</div>
                        <span class="font-bold text-slate-700 group-hover:text-slate-900 transition-colors text-sm md:text-base">${option.text}</span>
                    </div>
                    <div class="flex items-center gap-3">
                         <span class="px-2 py-1 rounded-md text-[10px] font-bold uppercase tracking-wider ${badgeClass}">+${option.score}</span>
                    </div>
                `;
                container.appendChild(btn);
            });
            lucide.createIcons();
        }

        function handleAnswer(option, category) {
            currentScore += option.score;
            answers.push({ 
                question: QUESTIONS[currentQuestionIndex].text, 
                answer: option.text, 
                points: option.score,
                category: category 
            });
            
            updateHUD(currentScore);
            logTerminal(`Recorded: ${option.text} [${category}]`, "success");

            if (currentQuestionIndex < QUESTIONS.length - 1) {
                currentQuestionIndex++;
                setTimeout(renderQuestion, 250);
            } else {
                finishAndRender();
            }
        }

        // --- RESULTS & GRAPH ---
        function finishAndRender() {
            const score = currentScore;
            
            // 1. Show Result Section
            showSection('step-result');

            // 2. UI Updates
            let badgeText = "OPTIMAL RESILIENCE";
            let colorClass = "text-emerald-500";
            let badgeColor = "bg-emerald-50 text-emerald-700 border-emerald-100";
            let videoList = VIDEOS.OPTIMAL;

            if (score < 70) {
                badgeText = "MODERATE RISK";
                colorClass = "text-amber-500";
                badgeColor = "bg-amber-50 text-amber-700 border-amber-100";
                videoList = VIDEOS.MODERATE;
            }
            if (score < 40) {
                badgeText = "CRITICAL DEPENDENCY";
                colorClass = "text-rose-500";
                badgeColor = "bg-rose-50 text-rose-700 border-rose-100";
                videoList = VIDEOS.CRITICAL;
            }

            // Select random video from the list
            const videoData = videoList[Math.floor(Math.random() * videoList.length)];

            document.getElementById('result-score').innerText = score;
            document.getElementById('result-score').className = `text-8xl font-black tracking-tighter ${colorClass}`;
            document.getElementById('score-badge').innerText = badgeText;
            document.getElementById('score-badge').className = `px-6 py-2 rounded-full border text-sm font-bold shadow-sm ${badgeColor}`;

            // 3. Video
            document.getElementById('video-title').innerText = videoData.title;
            document.getElementById('video-desc').innerText = videoData.desc;
            document.getElementById('video-thumb').src = videoData.thumb;
            document.getElementById('video-link').href = `https://www.youtube.com/watch?v=${videoData.id}`;

            // 4. Render Chart
            setTimeout(renderChart, 50);

            // 5. Fetch AI
            fetchAIDetails(score, answers);
        }

        function renderChart() {
            try {
                const categories = {}; 
                ["Exposure", "Dopamine", "Control", "Anxiety", "Sleep", "Mental", "Focus"].forEach(c => {
                    categories[c] = { earned: 0, count: 0 };
                });

                answers.forEach(a => {
                    if(categories[a.category]) {
                        categories[a.category].earned += a.points;
                        categories[a.category].count += 1;
                    }
                });

                const labels = Object.keys(categories);
                const dataPoints = labels.map(cat => {
                    const maxPossible = categories[cat].count * 10;
                    if(maxPossible === 0) return 0;
                    return (categories[cat].earned / maxPossible) * 100;
                });

                const ctx = document.getElementById('resultChart').getContext('2d');
                if(chartInstance) chartInstance.destroy();

                chartInstance = new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Resilience %',
                            data: dataPoints,
                            backgroundColor: 'rgba(99, 102, 241, 0.2)', // Indigo
                            borderColor: 'rgba(99, 102, 241, 1)',
                            borderWidth: 2,
                            pointBackgroundColor: '#fff',
                            pointBorderColor: 'rgba(99, 102, 241, 1)',
                            pointHoverBackgroundColor: '#4338ca',
                            pointHoverBorderColor: '#fff'
                        }]
                    },
                    options: {
                        maintainAspectRatio: false,
                        elements: { line: { tension: 0.3 } },
                        scales: {
                            r: {
                                angleLines: { color: '#e2e8f0' },
                                grid: { color: '#e2e8f0' },
                                pointLabels: {
                                    font: { size: 11, family: "'Inter', sans-serif", weight: '600' },
                                    color: '#64748b'
                                },
                                suggestedMin: 0,
                                suggestedMax: 100,
                                ticks: { display: false } // Hide numbers for cleaner look
                            }
                        },
                        plugins: { legend: { display: false } }
                    }
                });
            } catch (e) { console.error("Chart Error:", e); }
        }

        // --- DOWNLOAD REPORT ---
        function downloadReport() {
            const date = new Date().toLocaleDateString();
            let content = `MIND_SCRAPE PRO - CLINICAL REPORT\nDate: ${date}\n-----------------------------------\n\n`;
            content += `TOTAL RESILIENCE SCORE: ${currentScore}/100\n\n`;
            content += `USER RESPONSES:\n`;
            answers.forEach((a, i) => {
                content += `${i+1}. ${a.question}\n   Answer: ${a.answer} (${a.points} pts)\n`;
            });
            content += `\nAI ANALYSIS:\n${finalAIAnalysis || "Pending..."}\n`;
            
            const blob = new Blob([content], { type: "text/plain" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = `MindScrape_Report_${Date.now()}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // --- AI ---
        async function fetchAIDetails(score, finalAnswers) {
            const prompt = `
                Analyze User Score: ${score}/100.
                (0=Addicted, 100=Clean).
                User Answers: ${JSON.stringify(finalAnswers)}
                
                Generate JSON response:
                {
                  "title": "Archetype Title (e.g., Dopamine Miner)",
                  "analysis": "2-3 sentence analysis.",
                  "tips": ["Tip 1", "Tip 2"]
                }
            `;

            try {
                const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${API_KEY}`,
                        "Content-Type": "application/json",
                        "HTTP-Referer": "https://mindscrape.ai", 
                        "X-Title": "MindScrape AI"
                    },
                    body: JSON.stringify({
                        "model": "deepseek/deepseek-chat",
                        "messages": [
                            { "role": "system", "content": "Return valid JSON." },
                            { "role": "user", "content": prompt }
                        ]
                    })
                });

                if (!response.ok) throw new Error("API Error");
                const data = await response.json();
                const content = data.choices[0].message.content.replace(/```json/g, '').replace(/```/g, '').trim();
                const result = JSON.parse(content);
                
                finalAIAnalysis = `${result.title}: ${result.analysis}`; // Store for download
                updateTextUI(result);

            } catch (error) {
                console.error(error);
                updateTextUI({
                    title: "Offline Profile",
                    analysis: "Cloud analysis unavailable. Your local score indicates valid behavioral patterns.",
                    tips: ["Review daily stats", "Phone-free hour"]
                });
            }
        }

        function updateTextUI(data) {
            const titleEl = document.getElementById('result-title');
            const analysisEl = document.getElementById('result-analysis');
            const tipsEl = document.getElementById('result-tips');

            titleEl.classList.remove('shimmer', 'w-3/4', 'rounded');
            analysisEl.classList.remove('shimmer', 'h-32', 'w-full', 'rounded');
            
            titleEl.innerText = data.title;
            analysisEl.innerText = data.analysis;

            tipsEl.innerHTML = '';
            data.tips.forEach((tip, idx) => {
                tipsEl.innerHTML += `
                    <div class="flex gap-4 p-4 rounded-xl bg-slate-50 border border-slate-100 hover:bg-white hover:shadow-md transition-all">
                        <span class="flex-shrink-0 w-8 h-8 rounded-lg bg-indigo-50 text-indigo-600 font-bold flex items-center justify-center text-sm border border-indigo-100">0${idx + 1}</span>
                        <p class="text-slate-700 text-sm md:text-base pt-1 font-medium">${tip}</p>
                    </div>
                `;
            });
        }

        // --- CHAT ---
        async function sendChatMessage() {
            const input = document.getElementById('chat-input');
            const history = document.getElementById('chat-history');
            const msg = input.value.trim();
            if (!msg) return;

            history.innerHTML += `<div class="chat-bubble user-bubble fade-in">${msg}</div>`;
            input.value = '';
            history.scrollTop = history.scrollHeight;

            const loadingId = "loading-" + Date.now();
            history.innerHTML += `<div id="${loadingId}" class="chat-bubble ai-bubble text-slate-400 fade-in">Thinking...</div>`;
            history.scrollTop = history.scrollHeight;

            try {
                const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${API_KEY}`,
                        "Content-Type": "application/json",
                        "HTTP-Referer": "https://mindscrape.ai", 
                        "X-Title": "MindScrape AI"
                    },
                    body: JSON.stringify({
                        "model": "deepseek/deepseek-chat",
                        "messages": [
                            { "role": "system", "content": `You are Dr. AI. User scored ${currentScore}/100. Be helpful and brief.` },
                            { "role": "user", "content": msg }
                        ]
                    })
                });

                const data = await response.json();
                const aiMsg = data.choices[0].message.content;

                document.getElementById(loadingId).remove();
                history.innerHTML += `<div class="chat-bubble ai-bubble fade-in">${aiMsg}</div>`;
                history.scrollTop = history.scrollHeight;

            } catch (error) {
                document.getElementById(loadingId).innerText = "Connection Error.";
            }
        }
        /**
 * Toggles the Full Page Team Modal.
 * @param {boolean} show - True to show the modal, False to hide it.
 */
function toggleTeamModal(show) {
    const modal = document.getElementById('team-modal');
    if (show) {
        modal.classList.remove('hidden');
        // Prevent background scrolling when modal is open
        document.body.style.overflow = 'hidden'; 
    } else {
        modal.classList.add('hidden');
        // Restore scrolling
        document.body.style.overflow = 'auto'; 
    }
}
    </script>
</body>
</html>
